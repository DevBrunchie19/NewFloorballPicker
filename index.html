<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Floorball Team Picker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 40px auto;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    h1 {
      padding: 12px;
      background: #3a52a3;
      text-align: center;
      border-radius: 8px;
      color: #fff;
      font-size: clamp(1.5rem, 5vw, 2rem);
    }

    textarea, input {
      width: 100%;
      display: block;
      margin: 6px auto 12px auto;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
      box-sizing: border-box;
    }

    textarea { resize: none; min-height: 100px; }

    .button-wrapper { display: flex; justify-content: center; }

    .image-button {
      display: block;
      margin: 0 auto;
      width: 85px;
      cursor: pointer;
      filter: invert(29%) sepia(74%) saturate(488%) hue-rotate(189deg) brightness(100%) contrast(103%);
      transition: transform 0.15s ease;
    }

    .image-button:hover { transform: scale(1.1); }
    .image-button:active { transform: scale(0.95); }

    /* üîÑ BUTTON LOADING SPIN */
    .image-button.loading {
      animation: spin 0.6s linear infinite;
      opacity: 0.7;
      pointer-events: none;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    #buttonText {
      text-align:center;
      font-size:0.95rem;
      color:#555;
      margin-top:10px;
    }

    .team {
      background: #fff;
      padding: 12px;
      margin: 10px 0;
      border-radius: 8px;
      border:1px solid #ddd;
      --team-colour: #3a52a3;
    }

    .chips-header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:6px;
    }

    #clearChipsBtn {
      background: #3a52a3;
      color:white;
      border:none;
      border-radius:16px;
      padding:6px 12px;
      cursor:pointer;
      font-size:0.9rem;
      transition: background 0.2s ease, transform 0.1s ease, opacity 0.3s ease;
      opacity:0;
      pointer-events:none;
    }

    #clearChipsBtn.visible {
      opacity:1;
      pointer-events:auto;
    }

    #clearChipsBtn:hover { background:#516fd3; }
    #clearChipsBtn:active { transform:scale(0.95); }

    .chips-container {
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin:8px 0 12px 0;
    }

    .chip {
      padding:8px 14px;
      background:#e0e0e0;
      border-radius:20px;
      cursor:pointer;
      font-size:0.95rem;
      transition:all 0.2s ease;
      user-select:none;
    }

    .chip:hover { background:#d0d0d0; }
    .chip.selected {
      background:#3a52a3;
      color:white;
      box-shadow:0 2px 6px rgba(0,0,0,0.15);
    }

    .team-size-container {
      display:flex;
      gap:8px;
      margin:6px 0 12px 0;
    }

    .team-title {
      font-size:1.2rem;
      font-weight:bold;
      text-align:center;
      margin-bottom:10px;
    }

    .formation-container {
      display:flex;
      flex-direction:column;
      align-items:center;
      width:100%;
    }

    .formation-layout {
      width:100%;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:20px;
    }

    .subs-section {
      width:75%;
      background:#fafafa;
      border-radius:10px;
      padding:10px;
      border:1px solid #ddd;
      margin-top:16px;
      text-align:center;
      display:none;
    }

    .subs-section.visible { display:block; }

    .sub-card {
      padding:6px 10px;
      border:1px solid #ccc;
      border-radius:6px;
      background:#fff;
      margin:6px auto;
      display:inline-block;
    }

    .row-center { display:flex; flex-direction:column; align-items:center; }
    .row-two { width:80%; display:flex; justify-content:space-between; }
    .row-three { width:100%; display:flex; justify-content:space-between; }

    .player-block { display:flex; flex-direction:column; align-items:center; }

    .player-icon {
      width:80px;
      height:80px;
      border:2px dashed rgb(0 0 0 / 0%);
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      background-color:white;
      position: relative;
    }

    .player-icon.goalie { border-color:#f34471; }

    .shirt-icon {
      width:70%;
      height:70%;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .shirt-icon svg {
      width:100%;
      height:100%;
      color:var(--team-colour);
    }

    .player-name {
      margin-top:6px;
      font-weight:600;
      text-align:center;
    }

    .hat-icon {
      position:absolute;
      top:-15px;
      left:50%;
      transform:translateX(-50%);
      width:40px;
      pointer-events:none;
    }

    /* ===== MODAL (ANIMATED) ===== */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;

      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s ease;
    }

    .modal.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .modal-content {
      background: #f9f9f9;
      width: 95%;
      max-width: 700px;
      max-height: 90vh;
      overflow-y: auto;
      border-radius: 16px;
      padding: 20px;
      position: relative;

      transform: scale(0.95) translateY(10px);
      transition: transform 0.25s ease;
    }

    .modal.visible .modal-content {
      transform: scale(1) translateY(0);
    }

    .modal-close {
      position:absolute;
      top:10px;
      right:14px;
      background:none;
      border:none;
      font-size:1.5rem;
      cursor:pointer;
    }
  </style>
</head>

<body>

<h1>Floorball Team Picker</h1>

<div class="chips-header">
  <label>The usual suspects:</label>
  <button id="clearChipsBtn" onclick="clearAllPlayers()">Clear All</button>
</div>
<div id="playerChips" class="chips-container"></div>

<div class="chips-header"><label>The unusual suspects:</label></div>
<div id="unusualChips" class="chips-container"></div>

<div class="chips-header"><label>Goalies:</label></div>
<div id="goalieChips" class="chips-container"></div>

<label>Enter additional players:</label>
<textarea id="names"></textarea>

<label>Team size:</label>
<div class="team-size-container">
  <div class="chip" onclick="selectTeamSize(3,this)">3</div>
  <div class="chip" onclick="selectTeamSize(5,this)">5</div>
</div>
<input id="teamSize" type="number">

<div class="button-wrapper">
  <img src="Floorball_Blk@2x.png" class="image-button" onclick="generateTeams()">
</div>
<p id="buttonText">Click the floorball to generate teams</p>

<div id="teamsModal" class="modal" onclick="checkOutsideClick(event)">
  <div class="modal-content">
    <button class="modal-close" onclick="closeTeamsModal()">‚úï</button>
    <h2>Teams</h2>
    <div id="output"></div>
    <div id="exportToolbar" style="display:none;justify-content:center;gap:10px;margin-top:12px;">
      <button onclick="saveTeamsAsImage()">Save as Image</button>
      <button onclick="shareTeams()">Share Teams</button>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
/* ===== ORIGINAL JS (UNCHANGED EXCEPT generateTeams) ===== */

const commonPlayers=["Brunchie","Colin W-B","Nabber","Ben","Bill","Ron"];
const unusualPlayers=["Eugene","Dawn"];
const goalies=["Colin D","Sam","Cloth G"];

function createPlayerChips(){createChips(commonPlayers,"playerChips",togglePlayer);}
function createUnusualPlayerChips(){createChips(unusualPlayers,"unusualChips",togglePlayer);}
function createGoalieChips(){createChips(goalies,"goalieChips",toggleGoalie);}

function createChips(list,id,handler){
  const c=document.getElementById(id); c.innerHTML="";
  list.forEach(n=>{
    const chip=document.createElement("div");
    chip.className="chip";
    chip.textContent=n;
    chip.onclick=()=>handler(n,chip);
    c.appendChild(chip);
  });
}

function togglePlayer(name,chip){
  const t=document.getElementById("names");
  let n=t.value.split(",").map(x=>x.trim()).filter(Boolean);
  if(n.includes(name)){n=n.filter(x=>x!==name);chip.classList.remove("selected");}
  else{n.push(name);chip.classList.add("selected");}
  t.value=n.join(", "); updateClearButtonVisibility();
}

function toggleGoalie(name,chip){
  chip.classList.toggle("selected"); updateClearButtonVisibility();
}

function buildFinalPlayerPool(){
  return document.getElementById("names").value.split(",").map(n=>n.trim()).filter(Boolean);
}

function getSelectedGoalies(){
  return [...document.querySelectorAll("#goalieChips .chip.selected")].map(c=>c.textContent);
}

function selectTeamSize(size,chip){
  document.getElementById("teamSize").value=size;
  document.querySelectorAll(".team-size-container .chip").forEach(c=>c.classList.remove("selected"));
  chip.classList.add("selected");
}

function clearAllPlayers(){
  document.getElementById("names").value="";
  document.querySelectorAll(".chip").forEach(c=>c.classList.remove("selected"));
  updateClearButtonVisibility();
}

function updateClearButtonVisibility(){
  const has=buildFinalPlayerPool().length||getSelectedGoalies().length;
  document.getElementById("clearChipsBtn").classList.toggle("visible",has);
}

function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}}

/* üî• ENHANCED generateTeams */
function generateTeams(){
  const modal = document.getElementById("teamsModal");
  const output = document.getElementById("output");
  const button = document.querySelector(".image-button");

  button.classList.add("loading");
  modal.classList.add("visible");
  output.innerHTML = `<p style="text-align:center;font-weight:600;">üèë Generating teams‚Ä¶</p>`;

  setTimeout(() => {
    button.classList.remove("loading");

    let players = buildFinalPlayerPool();
    const selectedGoalies = getSelectedGoalies();
    const teamSize = parseInt(document.getElementById("teamSize").value, 10);

    if (!teamSize || teamSize < 1) {
      alert("Enter valid team size.");
      closeTeamsModal();
      return;
    }

    if (selectedGoalies.length) {
      const gSet = new Set(selectedGoalies.map(g => g.toLowerCase()));
      players = players.filter(p => !gSet.has(p.toLowerCase()));
    }

    shuffle(players);

    const numTeams = 2;
    const teams = Array.from({ length: numTeams }, () => []);
    const subsPerTeam = Array.from({ length: numTeams }, () => []);

    for (let i = 0; i < numTeams; i++) {
      if (selectedGoalies.length) {
        teams[i].push(selectedGoalies[i % selectedGoalies.length] + " (G)");
      }
    }

    let currentTeam = 0;
    for (const player of players) {
      const skaters = teams[currentTeam].filter(p => !p.includes("(G)")).length;
      if (skaters < teamSize) {
        teams[currentTeam].push(player);
      } else {
        subsPerTeam[currentTeam].push(player);
      }
      currentTeam = (currentTeam + 1) % numTeams;
    }

    renderTeams(teams, teamSize, subsPerTeam);

    const toolbarEl = document.getElementById("exportToolbar");
    if (toolbarEl) {
      toolbarEl.style.display =
        document.getElementById("output").innerText.trim() ? "flex" : "none";
    }

    if (!navigator.share) {
      const shareBtn = document.getElementById("shareTeamsBtn");
      if (shareBtn) shareBtn.style.display = "none";
    }

  }, 400);
}

function closeTeamsModal(){document.getElementById("teamsModal").classList.remove("visible");}
function checkOutsideClick(e){if(e.target.id==="teamsModal")closeTeamsModal();}

window.onload=()=>{
  createPlayerChips();
  createUnusualPlayerChips();
  createGoalieChips();
};
</script>

</body>
</html>
