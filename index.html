<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Floorball Team Picker</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f2f2f2;
        padding: 20px;
    }

    .title {
        text-align: center;
        font-size: 36px;
        font-weight: bold;
        padding: 20px;
        background: #2f4bab;
        color: white;
        border-radius: 10px;
        margin-bottom: 30px;
    }

    .section-title {
        font-size: 20px;
        font-weight: bold;
        margin-top: 20px;
    }

    .player-btn {
        display: inline-block;
        padding: 10px 20px;
        margin: 6px;
        border-radius: 25px;
        color: white;
        background: #365dc8;
        cursor: pointer;
        user-select: none;
    }

    .player-btn.selected {
        background: #1c2f66;
    }

    textarea {
        width: 100%;
        height: 70px;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #ccc;
    }

    #generateBtn {
        background: #3564d4;
        color: white;
        padding: 12px 25px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        margin-top: 20px;
        font-size: 18px;
    }

    .team {
        background: white;
        padding: 20px;
        border-radius: 12px;
        margin-top: 24px;
        display: flex;
        flex-direction: column;
    }

    .team-title {
        text-align: center;
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 15px;
    }

    .formation-wrapper {
        display: flex;
        gap: 12px;
    }

    .formation-layout {
        flex: 75%;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 30px;
    }

    .subs-section {
        flex: 25%;
        background: #f9f9f9;
        padding: 10px;
        border-radius: 10px;
        border: 1px solid #ddd;
        align-self: flex-start;
    }

    .row-center {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .row-two {
        width: 100%;
        display: flex;
        justify-content: space-between;
    }

    .player-block {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .player-icon {
        width: 70px;
        height: 70px;
        background: #3b56b2;
        border-radius: 50%;
    }

    .player-name {
        margin-top: 8px;
        font-weight: 600;
    }
</style>
</head>

<body>

<div class="title">Floorball Team Picker</div>

<div class="section-title">The usual suspects:</div>
<div id="commonPlayers"></div>

<div class="section-title">Goalies:</div>
<div id="goalies"></div>

<div class="section-title">Enter additional players (comma separated):</div>
<textarea id="additionalPlayers"></textarea>

<div class="section-title">Team size:</div>
<button class="player-btn selected" id="teamSize3">3</button>
<button class="player-btn" id="teamSize5">5</button>

<br>
<button id="generateBtn">Generate Teams</button>

<div id="output"></div>

<script>
/* ---------------------------
   INITIAL PLAYER LISTS
---------------------------- */
const commonList = ["Brunchie", "Colin W-B", "Nabber", "Ben", "Bill", "Ron", "Eugene"];
const goalieList = ["Colin D", "Sam", "ClothGimp"];

// Render buttons
function renderPlayerButtons() {
    const commonDiv = document.getElementById("commonPlayers");
    const goalieDiv = document.getElementById("goalies");

    commonList.forEach(p => {
        let btn = document.createElement("div");
        btn.className = "player-btn common-player";
        btn.textContent = p;
        btn.onclick = () => btn.classList.toggle("selected");
        commonDiv.appendChild(btn);
    });

    goalieList.forEach(p => {
        let btn = document.createElement("div");
        btn.className = "player-btn goalie-player";
        btn.textContent = p;
        btn.onclick = () => btn.classList.toggle("selected");
        goalieDiv.appendChild(btn);
    });
}
renderPlayerButtons();

/* ---------------------------
   TEAM SIZE SELECTION
---------------------------- */
let teamSize = 3;
document.getElementById("teamSize3").onclick = () => {
    teamSize = 3;
    document.getElementById("teamSize3").classList.add("selected");
    document.getElementById("teamSize5").classList.remove("selected");
};

document.getElementById("teamSize5").onclick = () => {
    teamSize = 5;
    document.getElementById("teamSize5").classList.add("selected");
    document.getElementById("teamSize3").classList.remove("selected");
};

/* ---------------------------
   CLEAN PLAYER BUILDER
---------------------------- */
function shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
}

function buildPlayerList() {
    const selectedCommon = Array.from(document.querySelectorAll(".common-player.selected"))
        .map(btn => btn.textContent.trim());

    const selectedGoalies = Array.from(document.querySelectorAll(".goalie-player.selected"))
        .map(btn => btn.textContent.trim() + " (G)");

    const extraRaw = document.getElementById("additionalPlayers").value;
    const extraPlayers = extraRaw
        .split(",")
        .map(n => n.trim())
        .filter(n => n.length > 0);

    let merged = [...selectedCommon, ...extraPlayers];

    // âœ… remove duplicates
    merged = [...new Set(merged)];

    // âœ… remove players who are chosen as goalies (non-G version)
    const goalieNames = selectedGoalies.map(g => g.replace(" (G)", "").trim());
    merged = merged.filter(p => !goalieNames.includes(p));

    shuffle(merged);

    return {
        fieldPlayers: merged,
        goalies: selectedGoalies
    };
}

/* ---------------------------
   TEAM GENERATION
---------------------------- */
document.getElementById("generateBtn").onclick = () => {
    const { fieldPlayers, goalies } = buildPlayerList();

    const totalPlayers = [...fieldPlayers, ...goalies];
    const teamCount = Math.floor(totalPlayers.length / teamSize);

    shuffle(totalPlayers);

    const teams = [];
    for (let i = 0; i < teamCount; i++) {
        teams.push([]);
    }

    let teamIndex = 0;
    totalPlayers.forEach(player => {
        teams[teamIndex].push(player);
        teamIndex = (teamIndex + 1) % teamCount;
    });

    renderTeams(teams);
};

/* ---------------------------
   HELPER RENDERING FUNCTIONS
---------------------------- */
function formatPlayer(p) {
    if (!p) return "";
    return p.includes("(G)") ? "ðŸ§¤ " + p : p;
}

function centeredRow(player) {
    return `
        <div class="row-center">
            <div class="player-icon"></div>
            <div class="player-name">${formatPlayer(player)}</div>
        </div>
    `;
}

function twoAcrossRow(left, right) {
    return `
        <div class="row-two">
            <div class="player-block">
                <div class="player-icon"></div>
                <div class="player-name">${formatPlayer(left)}</div>
            </div>
            <div class="player-block">
                <div class="player-icon"></div>
                <div class="player-name">${formatPlayer(right)}</div>
            </div>
        </div>
    `;
}

/* ---------------------------
   RENDER TEAMS
---------------------------- */
function renderTeams(teams) {
    const output = document.getElementById("output");
    output.innerHTML = "";

    teams.forEach((team, i) => {
        // extract goalie
        const goalieIndex = team.findIndex(p => p.includes("(G)"));
        let goalie = null;

        if (goalieIndex >= 0) {
            goalie = team.splice(goalieIndex, 1)[0];
        }

        const mainPlayers = team.slice(0, 3);
        const subs = team.slice(3);

        const goalieTop = i % 2 === 0;

        let html = `<div class="team"><div class="team-title">Team ${i + 1}</div>`;

        html += `
            <div class="formation-wrapper">
                <div class="formation-layout">
                    ${centeredRow(goalieTop ? goalie : mainPlayers[0])}
                    ${twoAcrossRow(mainPlayers[0], mainPlayers[1])}
                    ${centeredRow(!goalieTop ? goalie : mainPlayers[2])}
                </div>

                <div class="subs-section">
                    <div style="font-weight:bold; text-align:center;">Subs</div>
                    <div style="margin-top:10px;">
                        ${subs.length === 0 ? "None" : subs.map(p => `
                            <div style="padding:4px 6px; border:1px solid #ccc; border-radius:6px; background:#fff; margin-bottom:5px;">
                                ${formatPlayer(p)}
                            </div>
                        `).join("")}
                    </div>
                </div>
            </div>
        `;

        html += `</div>`;
        output.innerHTML += html;
    });
}
</script>

</body>
</html>
