<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Floorball Team Picker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
/* ===== ORIGINAL CSS (UNCHANGED) ===== */
body {
  font-family: Arial, sans-serif;
  max-width: 600px;
  margin: 40px auto;
  padding: 20px;
  background: #f9f9f9;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
h1 {
  padding: 12px;
  background: #3a52a3;
  text-align: center;
  border-radius: 8px;
  color: #fff;
  font-size: clamp(1.5rem, 5vw, 2rem);
}
textarea, input {
  width: 100%;
  display: block;
  margin: 6px auto 12px auto;
  padding: 12px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 1rem;
  box-sizing: border-box;
}
textarea { resize: none; min-height: 100px; }
.button-wrapper { display: flex; justify-content: center; }

.image-button {
  display: block;
  margin: 0 auto;
  width: 85px;
  cursor: pointer;
  filter: invert(29%) sepia(74%) saturate(488%) hue-rotate(189deg);
  transition: transform 0.15s ease, opacity 0.2s ease;
}
.image-button:hover { transform: scale(1.1); }
.image-button:active { transform: scale(0.95); }

/* ✅ BUTTON LOADING ANIMATION (NEW) */
.image-button.loading {
  animation: spin 0.6s linear infinite;
  opacity: 0.7;
}
@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

/* ===== MODAL (UPDATED, SAFE) ===== */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;

  opacity: 0;
  pointer-events: none;
  transition: opacity 0.25s ease;
}
.modal.visible {
  opacity: 1;
  pointer-events: auto;
}
.modal-content {
  background: #f9f9f9;
  width: 95%;
  max-width: 700px;
  max-height: 90vh;
  overflow-y: auto;
  border-radius: 16px;
  padding: 20px;
  position: relative;

  transform: scale(0.95) translateY(12px);
  transition: transform 0.25s ease;
}
.modal.visible .modal-content {
  transform: scale(1) translateY(0);
}
.modal-close {
  position: absolute;
  top: 10px;
  right: 14px;
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
}

/* ===== REST OF YOUR CSS CONTINUES UNCHANGED ===== */
/* (chips, formations, players, etc — untouched) */
</style>
</head>

<body>
<h1>Floorball Team Picker</h1>

<!-- (HTML UNCHANGED — omitted here for brevity, but KEEP YOUR FULL HTML EXACTLY AS POSTED) -->

<script>
/* ===== ONLY generateTeams() IS TOUCHED ===== */

function generateTeams(){
  const button = document.querySelector(".image-button");
  button.classList.add("loading");

  // ⏳ SHORT DELAY FOR "GENERATING" FEEL
  setTimeout(() => {

    let players = buildFinalPlayerPool();
    const selectedGoalies = getSelectedGoalies();
    const teamSize = parseInt(document.getElementById("teamSize").value,10);

    if(!teamSize || teamSize < 1){
      alert("Enter valid team size.");
      button.classList.remove("loading");
      return;
    }

    if(selectedGoalies.length){
      const gSet=new Set(selectedGoalies.map(g=>g.toLowerCase()));
      players=players.filter(p=>!gSet.has(p.toLowerCase()));
    }

    shuffle(players);

    const teams=[[],[]];
    const subsPerTeam=[[],[]];

    selectedGoalies.forEach((g,i)=>{
      teams[i%2].push(g+" (G)");
    });

    let currentTeam=0;
    for(const p of players){
      const skaters=teams[currentTeam].filter(x=>!x.includes("(G)")).length;
      if(skaters<teamSize){
        teams[currentTeam].push(p);
      }else{
        subsPerTeam[currentTeam].push(p);
      }
      currentTeam=(currentTeam+1)%2;
    }

    renderTeams(teams,teamSize,subsPerTeam);

    document.getElementById("teamsModal").classList.add("visible");
    button.classList.remove("loading");

  }, 300);
}
</script>

</body>
</html>
