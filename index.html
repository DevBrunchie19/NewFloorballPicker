<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Floorball Team Picker â€” Full Version</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
/* --- Base Styles --- */
body {
  font-family: Arial, sans-serif;
  max-width: 650px;
  margin: 40px auto;
  padding: 20px;
  background: #f9f9f9;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
h1 { padding: 12px; background: #3a52a3; text-align: center; border-radius: 8px; color: #fff; }
textarea,input { width:100%; margin-top:6px; padding:12px; border-radius:6px; border:1px solid #ccc; }
button { margin-top:14px; width:100%; padding:12px; font-size:1.1rem; background:#3a52a3; color:#fff; border:none; border-radius:6px; cursor:pointer; }
button:hover { background:#2b3a7d; }

.chips-container { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:12px; }
.chip { padding:8px 14px; background:#e0e0e0; border-radius:20px; cursor:pointer; transition:0.2s; user-select:none; display:flex; align-items:center; gap:6px; }
.chip.selected { background:#3a52a3; color:white; }

/* --- Team Card --- */
.team { background:white; border:1px solid #ddd; padding:14px; border-radius:10px; margin-top:16px; }
.team-title { font-size:1.2rem; font-weight:bold; text-align:center; margin-bottom:10px; }

/* --- 75/25 Formation Layout --- */
.formation-container { display:flex; gap:20px; justify-content:space-between; align-items:flex-start; }
.formation-layout { width:75%; display:flex; flex-direction:column; align-items:center; gap:20px; }
.subs-section { width:25%; min-width:120px; background:#fafafa; border-radius:10px; padding:10px; border:1px solid #ddd; height:fit-content; }
.sub-card { padding:6px 10px; border:1px solid #ccc; border-radius:6px; background:#fff; margin-bottom:6px; }

.row-center { display:flex; flex-direction:column; align-items:center; }
.row-two { width:100%; display:flex; justify-content:space-between; }
.player-block { display:flex; flex-direction:column; align-items:center; }
.player-icon { width:60px; height:60px; background:#3a52a3; border-radius:50%; }
.player-name { margin-top:6px; font-weight:600; }

/* small screens: stack */
@media (max-width:640px) {
  .formation-container { flex-direction:column; }
  .formation-layout { width:100%; }
  .subs-section { width:100%; }
}

/* Floorball icon button in chips */
.chip .icon-btn {
  width:18px; height:18px; background:url('https://img.icons8.com/ios-filled/50/stick-figure.png') no-repeat center center; background-size:contain; cursor:pointer;
}
</style>
</head>
<body>
<h1>Floorball Team Picker</h1>

<div><strong>The usual suspects:</strong></div>
<div id="playerChips" class="chips-container"></div>

<div><strong>Goalies:</strong></div>
<div id="goalieChips" class="chips-container"></div>

<label>Enter additional players (comma separated):</label>
<textarea id="names" placeholder="Gretzky, McLovin, ..."></textarea>

<label>Team size:</label>
<div id="teamSizeChips" class="chips-container">
  <div class="chip" onclick="selectTeamSize(3,this)">3</div>
  <div class="chip" onclick="selectTeamSize(5,this)">5</div>
</div>
<input type="number" id="teamSize" placeholder="3">

<button onclick="generateTeams()">Generate Teams</button>
<button onclick="resetSelection()">Reset Selection</button>
<button onclick="saveTeams()">Save & Share</button>

<h2>Teams:</h2>
<div id="output"></div>

<script>
/* -----------------------------
   Data + UI Setup
-------------------------------- */
const commonPlayers = ["Brunchie", "Colin W-B", "Nabber", "Ben", "Bill", "Ron", "Eugene"];
const goalies = ["Colin D", "Sam", "ClothGimp"];

document.addEventListener("DOMContentLoaded", () => {
  createChips(commonPlayers, "playerChips", togglePlayer, true);
  createChips(goalies, "goalieChips", toggleGoalie, false);
  loadFromURL();
});

/* -----------------------------
   Utilities
-------------------------------- */
function shuffle(arr) { for (let i = arr.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [arr[i], arr[j]] = [arr[j], arr[i]]; } }
function normalizeName(n) { return n.replace(/\s+/g, ' ').trim(); }

function dedupePreserveOrder(arr) {
  const seen = new Set();
  const out = [];
  for (const raw of arr) {
    if (!raw) continue;
    const name = normalizeName(raw);
    const key = name.toLowerCase();
    if (!seen.has(key)) { seen.add(key); out.push(name); }
  }
  return out;
}

/* -----------------------------
   Chips
-------------------------------- */
function createChips(list, containerId, handler, withIcon) {
  const container = document.getElementById(containerId);
  container.innerHTML = "";
  list.forEach(name => {
    const chip = document.createElement("div");
    chip.className = "chip";
    chip.textContent = name;
    if (withIcon) {
      const icon = document.createElement("div");
      icon.className = "icon-btn";
      icon.onclick = e => {
        e.stopPropagation();
        alert(name + " marked with floorball icon!"); // Placeholder action
      };
      chip.appendChild(icon);
    }
    chip.onclick = () => handler(name, chip);
    container.appendChild(chip);
  });
}

function togglePlayer(name, chip) {
  chip.classList.toggle("selected");
  updateTextareaFromSelection();
}
function toggleGoalie(name, chip) { chip.classList.toggle("selected"); }

/* -----------------------------
   Selection & parsing
-------------------------------- */
function getSelectedPlayersFromChips() {
  return Array.from(document.querySelectorAll("#playerChips .chip.selected"))
    .map(c => normalizeName(c.childNodes[0].textContent));
}

function getPlayersFromTextarea() {
  const raw = document.getElementById("names").value || "";
  if (!raw.trim()) return [];
  return dedupePreserveOrder(raw.split(",").map(s => normalizeName(s)).filter(Boolean));
}

function buildFinalPlayerPool() {
  const selectedChips = getSelectedPlayersFromChips();
  const typed = getPlayersFromTextarea();
  const seen = new Set(selectedChips.map(p => p.toLowerCase()));
  const merged = [...selectedChips];

  for (const t of typed) {
    if (!seen.has(t.toLowerCase())) {
      merged.push(t);
      seen.add(t.toLowerCase());
    }
  }
  return dedupePreserveOrder(merged);
}

function updateTextareaFromSelection() {
  const merged = buildFinalPlayerPool();
  document.getElementById("names").value = merged.join(", ");
}

function getSelectedGoalies() {
  return Array.from(document.querySelectorAll("#goalieChips .chip.selected"))
    .map(c => normalizeName(c.textContent));
}

/* -----------------------------
   Team size chip UI
-------------------------------- */
function selectTeamSize(size, chip) {
  document.getElementById("teamSize").value = size;
  document.querySelectorAll("#teamSizeChips .chip").forEach(c => c.classList.remove("selected"));
  chip.classList.add("selected");
}

/* -----------------------------
   Team generation
-------------------------------- */
function generateTeams() {
  let players = buildFinalPlayerPool();
  const selectedGoalies = getSelectedGoalies();

  if (selectedGoalies.length) {
    const goalieSet = new Set(selectedGoalies.map(g => g.toLowerCase()));
    players = players.filter(p => !goalieSet.has(p.toLowerCase()));
  }

  const teamSize = parseInt(document.getElementById("teamSize").value, 10);
  if (!teamSize || teamSize < 1) {
    alert("Enter a valid team size.");
    return;
  }

  shuffle(players);

  const numTeams = 2;
  const teams = Array.from({ length: numTeams }, () => []);
  const subsPerTeam = Array.from({ length: numTeams }, () => []);

  // Assign one goalie per team
  for (let i = 0; i < numTeams; i++) {
    if (selectedGoalies.length) {
      const g = selectedGoalies[i % selectedGoalies.length];
      teams[i].push(g + " (G)");
    }
  }

  // Assign skaters up to teamSize per team (goalie does not count)
  let currentTeam = 0;
  for (const player of players) {
    const skaterCount = teams[currentTeam].filter(p => !p.includes("(G)")).length;
    if (skaterCount < teamSize) {
      teams[currentTeam].push(player);
    } else {
      subsPerTeam[currentTeam].push(player);
    }
    currentTeam = (currentTeam + 1) % numTeams;
  }

  renderTeams(teams, teamSize, subsPerTeam);
}

/* -----------------------------
   Reset selection
-------------------------------- */
function resetSelection() {
  document.getElementById("names").value = "";
  document.getElementById("teamSize").value = "";
  document.querySelectorAll(".chip").forEach(c => c.classList.remove("selected"));
  document.getElementById("output").innerHTML = "";
}

/* -----------------------------
   Save & Share
-------------------------------- */
function saveTeams() {
  const names = encodeURIComponent(document.getElementById("names").value);
  const size = document.getElementById("teamSize").value;
  const url = `${window.location.origin}${window.location.pathname}?names=${names}&size=${size}`;
  prompt("Share this URL:", url);
}

function loadFromURL() {
  const params = new URLSearchParams(window.location.search);
  const names = params.get("names");
  const size = params.get("size");
  if (names) document.getElementById("names").value = decodeURIComponent(names);
  if (size) document.getElementById("teamSize").value = size;
}

/* -----------------------------
   Team Sheet Rendering
-------------------------------- */
function renderTeams(teams, teamSize, subsPerTeam) {
  const teamNames = [
    "The Five-Hole Fiddlers","Goal Diggers","Ball Blazers","Stick Flickers",
    "The Mighty Dangles","Deez Sticks","Floor Fury","The Dirty Dekes",
    "Stickflix and Chill","The Deflectors","Ballz Deep","Just the Tip-Ins","The Slap and Tickles"
  ];
  shuffle(teamNames);

  const out = document.getElementById("output");
  out.innerHTML = "";

  teams.forEach((team, i) => {
    const displayName = teamNames[i % teamNames.length];

    let goalie = null;
    let playersOnly = team.slice();
    if (playersOnly.length && playersOnly[0] && playersOnly[0].includes("(G)")) {
      goalie = playersOnly[0];
      playersOnly = playersOnly.slice(1);
    }

    const substitutes = (subsPerTeam && subsPerTeam[i]) ? subsPerTeam[i].slice() : [];

    const goalieTop = i % 2 === 0;

    let topSlot, midLeft, midRight, bottomSlot;

    if (goalieTop) {
      topSlot = goalie;
      midLeft  = playersOnly[0] || "";
      midRight = playersOnly[1] || "";
      bottomSlot = playersOnly[2] || "";
    } else {
      topSlot = playersOnly[0] || "";
      midLeft  = playersOnly[1] || "";
      midRight = playersOnly[2] || "";
      bottomSlot = goalie;
    }

    const cardHtml = `
      <div class="team">
        <div class="team-title">${displayName}</div>
        <div class="formation-container">
          <div class="formation-layout">
            ${centeredRow(topSlot)}
            ${twoAcrossRow(midLeft, midRight)}
            ${centeredRow(bottomSlot)}
          </div>

          <div class="subs-section">
            <div style="font-weight:bold; text-align:center; margin-bottom:8px;">Subs</div>
            ${substitutes.length === 0 ? `<div style="text-align:center;">None</div>` :
              substitutes.map(s => `<div class="sub-card">${formatPlayer(s)}</div>`).join("")}
          </div>
        </div>
      </div>
    `;
    out.insertAdjacentHTML('beforeend', cardHtml);
  });
}

function centeredRow(player) {
  if (!player) return `<div class="row-center"><div style="height:46px"></div></div>`;
  return `
    <div class="row-center">
      <div class="player-icon"></div>
      <div class="player-name">${formatPlayer(player)}</div>
    </div>
  `;
}

function twoAcrossRow(left, right) {
  return `
    <div class="row-two">
      <div class="player-block">
        <div class="player-icon"></div>
        <div class="player-name">${formatPlayer(left)}</div>
      </div>
      <div class="player-block">
        <div class="player-icon"></div>
        <div class="player-name">${formatPlayer(right)}</div>
      </div>
    </div>
  `;
}

function formatPlayer(p) {
  if (!p) return "";
  if (p.includes("(G)")) {
    const raw = p.replace("(G)", "").trim();
    return "ðŸ§¤ " + raw;
  }
  return p;
}
</script>
</body>
</html>
